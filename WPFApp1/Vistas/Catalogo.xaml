<UserControl x:Class="WPFApp1.Vistas.Catalogo"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:conv="clr-namespace:WPFApp1.Converters" FontFamily="Roboto"
             mc:Ignorable="d" FontSize="12"
             xmlns:behaviors="clr-namespace:WPFApp1.Recursos"
             xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
             d:DesignHeight="450" d:DesignWidth="800" Loaded="UserControl_Loaded">
    <UserControl.Resources>
        
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="Iconos.xaml"/>
            </ResourceDictionary.MergedDictionaries>
            <BooleanToVisibilityConverter x:Key="BooleanToVisibility"/>
            <conv:PreferirFechaConverter x:Key="PreferirFechaConverter"/>
            <ContextMenu x:Key="MenuContextualGaleria">
                <MenuItem Header="Editar"
                    Command="{Binding DataContext.ItemDoubleClickCommand, Source={x:Reference CatalogoItems}}"
                    CommandParameter="{Binding}" />
                <MenuItem Header="Eliminar"
                    Command="{Binding DataContext.EliminarItemCommand, Source={x:Reference CatalogoItems}}"
                    CommandParameter="{Binding}" />
                <MenuItem Header="Vender Item"
                    Command="{Binding DataContext.AniadirItemCarritoCommand, Source={x:Reference CatalogoItems}}"
                    CommandParameter="{Binding}" />
                <Separator/>
                <MenuItem Header="Añadir a lote de edición"
                    Command="{Binding DataContext.AniadirItemLoteEdicionCommand, Source={x:Reference CatalogoItems}}"
                    CommandParameter="{Binding}" />
                <MenuItem Header="Duplicar"
                    Command="{Binding DataContext.DuplicarItemCommand, Source={x:Reference CatalogoItems}}"
                    CommandParameter="{Binding}" />
                <MenuItem Header="Reservar"/>
                <Separator/> 
                <MenuItem Header="Añadir a lista para exportar"/>
            </ContextMenu>

            <ContextMenu x:Key="MenuContextualTabla">
                <MenuItem Header="Editar"
                    Command="{Binding Path=DataContext.ItemDoubleClickCommand, RelativeSource={RelativeSource AncestorType={x:Type DataGrid}}}"
                    CommandParameter="{Binding}" />
                <MenuItem Header="Eliminar"
                    Command="{Binding Path=DataContext.EliminarItemCommand, RelativeSource={RelativeSource AncestorType={x:Type DataGrid}}}"
                    CommandParameter="{Binding}" />
                <MenuItem Header="Vender item"
                    Command="{Binding Path=DataContext.AniadirItemCarritoCommand, RelativeSource={RelativeSource AncestorType={x:Type DataGrid}}}"
                    CommandParameter="{Binding}" />
                <Separator/>
                <MenuItem Header="Añadir a lote de edición"
                    Command="{Binding Path=DataContext.AniadirItemLoteEdicionCommand, RelativeSource={RelativeSource AncestorType={x:Type DataGrid}}}"
                    CommandParameter="{Binding}" />
                <MenuItem Header="Duplicar"
                    Command="{Binding Path=DataContext.DuplicarItemCommand, RelativeSource={RelativeSource AncestorType={x:Type DataGrid}}}"
                    CommandParameter="{Binding}" />
                <MenuItem Header="Reservar"/>
                <Separator/>
                <MenuItem Header="Añadir a lista para exportar"/>
            </ContextMenu>
        </ResourceDictionary>
    </UserControl.Resources>
    <Grid x:Name="Grilla1">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="20"/>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="10"/>
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="20"/>
            <RowDefinition Height="auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="20"/>
        </Grid.RowDefinitions>

        <!--Panel-->
        <Grid Grid.Row="1" Grid.Column="1" Margin="0,0,0,10" x:Name="Cabecera">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <StackPanel Orientation="Horizontal" Grid.Column="0">
                <TextBlock FontSize="36" FontWeight="Bold" Text="{Binding TituloVista}"/>
                <!--Throbber-->
                <Border Margin="5">
                    <ContentControl x:Name="Throbber" Visibility="{Binding Procesando, Converter={StaticResource BooleanToVisibility}}">
                        <ContentControl.Content >
                            <Path Style="{StaticResource ThrobberSimpleEstilo}"
                            VerticalAlignment="Center" HorizontalAlignment="Center">
                                <Path.RenderTransform>
                                    <ScaleTransform ScaleX="1" ScaleY="1"/>
                                </Path.RenderTransform>
                                <Path.RenderTransformOrigin>
                                    <Point X="0.5" Y="0.5"/>
                                </Path.RenderTransformOrigin>
                            </Path>
                        </ContentControl.Content>
                    </ContentControl>
                </Border>

                <Button x:Name="Retroceso" Margin="5,0,0,0" BorderThickness="0" Command="{Binding LimpiarBusquedaCommand}" Cursor="Hand"
                        Visibility="{Binding MostrarBotonRegresar, Converter={StaticResource BooleanToVisibility}}">
                    <Button.Background>
                        <SolidColorBrush Color="Transparent"/>
                    </Button.Background>
                    <Image Width="25" Height="25" Source="/iconos/retroceso1.png" Style="{StaticResource ImagenHover}"/>
                </Button>
            </StackPanel>

            <StackPanel HorizontalAlignment="Right" Orientation="Horizontal" Grid.Column="1" x:Name="PanelBusqueda" Grid.ColumnSpan="2">
                <Button Style="{StaticResource BotonSinEstilo}" Margin="10,2,10,0" Cursor="Hand"
                    HorizontalAlignment="Center" VerticalAlignment="Center" Command="{Binding ToggleBusquedaAvanzadaCommand}">
                    <Button.Background>
                        <SolidColorBrush Color="Transparent"/>
                    </Button.Background>
                    <Image Width="24" Height="24" Source="/iconos/botonSuma1.png" Style="{StaticResource ImagenHover}"/>
                </Button>
                
                <Border Background="White"
                    CornerRadius="10"
                    Height="30" x:Name="BackgroundBusqueda"
                    Width="250"
                    HorizontalAlignment="Left"
                    Margin="0,0,10,0">
                    <Border.InputBindings>
                        <KeyBinding Key="Enter" Command="{Binding EjecutarBusquedaCommand}"/>
                    </Border.InputBindings>
                    
                    <Grid Margin="2">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="auto"/>
                            <RowDefinition Height="auto"/>
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="auto"/>
                        </Grid.ColumnDefinitions>

                        <Button x:Name="Busqueda" Margin="10,3" BorderThickness="0" Command="{Binding EjecutarBusquedaCommand}" 
                            HorizontalAlignment="Left" Grid.Column="0" Cursor="Hand">
                            <Button.Background>
                                <SolidColorBrush Color="Transparent"/>
                            </Button.Background>
                            <Image Width="20" Height="20" Source="/iconos/busqueda1.png"/>
                        </Button>
                        <TextBlock x:Name="Placeholder"
                       Text="Buscar"
                       Grid.Column="1"
                       IsHitTestVisible="False"
                       VerticalAlignment="Center"
                       HorizontalAlignment="Left"
                       Margin="40,0,0,7"
                       Foreground="#A0A0A0"
                       Width="200"
                       Height="20"
                       FontSize="18">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding ElementName=BusquedaTextbox, Path=Text.IsEmpty}" Value="True">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>
                        <TextBox x:Name="BusquedaTextbox" 
                                 Height="20" 
                                 Margin="0,0,0,7"
                                 Width="200" 
                                 Background="Transparent" 
                                 FontSize="18" 
                                 TextAlignment="Center" 
                                 Grid.Column="1"
                                 BorderThickness="0"
                                 Text="{Binding TextoBusqueda, UpdateSourceTrigger=PropertyChanged}">
                            <TextBox.Style>
                                <Style TargetType="TextBox">
                                    <Style.Triggers>
                                        <Trigger Property="IsKeyboardFocused" Value="True">
                                            <Setter Property="Foreground" Value="Black"/>
                                        </Trigger>
                                        <Trigger Property="Text" Value="">
                                            <Setter Property="Foreground" Value="Transparent"/>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBox.Style>
                            <i:Interaction.Triggers>
                                <i:EventTrigger EventName="GotFocus">
                                    <i:InvokeCommandAction Command="{Binding BusquedaRecibeFocoCommand}"/>
                                </i:EventTrigger>

                                <i:EventTrigger EventName="LostFocus">
                                    <i:InvokeCommandAction Command="{Binding BusquedaPierdeFocoCommand}"/>
                                </i:EventTrigger>
                            </i:Interaction.Triggers>
                        </TextBox>

                        <Popup IsOpen="{Binding HistorialVisible}"
                           PlacementTarget="{Binding ElementName=BackgroundBusqueda}"
                           Placement="Bottom"        
                           StaysOpen="True"
                           AllowsTransparency="True"
                           PopupAnimation="Fade"
                           Panel.ZIndex="1000"
                           VerticalOffset="10" Cursor="">
                            <Border Background="White" BorderBrush="#CCC" BorderThickness="0.5" Padding="2"
                                Width="{Binding ElementName=BackgroundBusqueda, Path=ActualWidth}" >
                                <ListBox ItemsSource="{Binding BusquedasRecientes}" ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                                    <ListBox.ItemTemplate>
                                        <DataTemplate>
                                            <Button Command="{Binding DataContext.SeleccionarBusquedaPreviaCommand,
                                                    RelativeSource={RelativeSource AncestorType=Popup}}"
                                                    CommandParameter="{Binding}"
                                                    Background="Transparent"
                                                    BorderThickness="0" Width="{Binding ElementName=BackgroundBusqueda, Path=ActualWidth}"
                                                    Padding="6,4"
                                                    Cursor="Hand"
                                                    HorizontalAlignment="Stretch"
                                                    HorizontalContentAlignment="Stretch">
                                                <StackPanel Orientation="Horizontal">
                                                    <Image Source="/iconos/Reciente1.png"
                                                       Width="14" Height="14"
                                                       Opacity="0.7"
                                                       Margin="0,0,7,0"
                                                       VerticalAlignment="Center"/>
                                                    <TextBlock Text="{Binding}"
                                                       FontSize="16"
                                                       Foreground="Gray"
                                                       VerticalAlignment="Center"/>
                                                </StackPanel>
                                            </Button>
                                        </DataTemplate>
                                    </ListBox.ItemTemplate>
                                </ListBox>
                            </Border>
                        </Popup>
                        <Popup IsOpen="{Binding BusquedaAvanzadaActiva}"
                           PlacementTarget="{Binding ElementName=PanelBusqueda}"
                           Placement="Bottom"     
                           StaysOpen="True"
                           AllowsTransparency="True"
                           PopupAnimation="Fade"
                           Panel.ZIndex="1000" Cursor="Hand"
                           VerticalOffset="10">
                            <Border Background="White" BorderBrush="Black" BorderThickness="0.5" Padding="15"
                                    >
                                <Border.Effect>
                                    <DropShadowEffect BlurRadius="10"
                                        ShadowDepth="0.1"
                                        Direction="0"
                                        Opacity="0.1"/>
                                </Border.Effect>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="auto"/>
                                        <ColumnDefinition Width="auto"/>
                                        <ColumnDefinition Width="auto"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="auto"/>
                                    </Grid.RowDefinitions>

                                    <StackPanel Orientation="Vertical" Grid.Column="0" Grid.Row="0" Margin="10,0">

                                        <TextBlock Text="Categoría" FontSize="20"/>
                                        <StackPanel Orientation="Horizontal" Margin="0,5,0,0">
                                            <ComboBox Style="{StaticResource CBOXValidable}"
                                                DisplayMemberPath="Nombre" Cursor="Hand"
                                                x:Name="Categorias" FontSize="20"
                                                SelectedItem="{Binding CategoriaBuscada, Mode=TwoWay}"
                                                ItemsSource="{Binding ColeccionCategorias}"
                                                Margin="2">
                                            </ComboBox>
                                            <Button BorderThickness="0" Command="{Binding IngresarCategoriaCommand}" Margin="10,0,0,0" Grid.Column="1">
                                                <Button.Background>
                                                    <SolidColorBrush Color="Transparent"/>
                                                </Button.Background>
                                                <Image Width="14" Height="14" Source="/iconos/lapizEdicion.png"/>
                                            </Button>
                                        </StackPanel>

                                        <TextBlock Text="Exclusivas" FontSize="20" Margin="0,10,0,0"/>
                                        <CheckBox IsChecked="{Binding ToggleItemsExistentes}" IsThreeState="True" Cursor="Hand" Margin="0,5,0,0">
                                            <TextBlock FontWeight="Regular" FontSize="14">Items con existencias</TextBlock>
                                        </CheckBox>
                                        <CheckBox IsChecked="{Binding ToggleItemsPrecioPublico}" IsThreeState="True" Cursor="Hand" Margin="0,2,0,0">
                                            <TextBlock FontWeight="Regular" FontSize="14">Items con Precio Publico</TextBlock>
                                        </CheckBox>
                                        <CheckBox IsChecked="{Binding ToggleItemsVisibilidadWeb}" IsThreeState="True" Cursor="Hand" Margin="0,2,0,0">
                                            <TextBlock FontWeight="Regular" FontSize="14">Items que se muestran Online</TextBlock>
                                        </CheckBox>
                                    </StackPanel>

                                    <StackPanel Orientation="Vertical" Grid.Column="1" Grid.Row="0" Margin="50,0">
                                        <TextBlock Text="Marca" FontSize="20"/>
                                        <StackPanel Orientation="Horizontal" Margin="0,5,0,0">
                                            <ComboBox Style="{StaticResource CBOXValidable}"
                                                DisplayMemberPath="Nombre"
                                                x:Name="Marcas" FontSize="20"
                                                SelectedItem="{Binding MarcaBuscada, Mode=TwoWay}"
                                                ItemsSource="{Binding ColeccionMarcas}"
                                                Margin="2" Cursor="Hand">
                                            </ComboBox>
                                            <Button BorderThickness="0" Command="{Binding IngresarMarcaCommand}" Margin="10,0,0,0" Grid.Column="1">
                                                <Button.Background>
                                                    <SolidColorBrush Color="Transparent"/>
                                                </Button.Background>
                                                <Image Width="14" Height="14" Source="/iconos/lapizEdicion.png"/>
                                            </Button>
                                        </StackPanel>

                                        <TextBlock Text="Ubicacion" FontSize="20" Margin="0,10,0,0"/>
                                        <StackPanel Orientation="Horizontal" Margin="0,5,0,0">
                                            <ComboBox Style="{StaticResource CBOXValidable}"
        DisplayMemberPath="Nombre" Cursor="Hand"
        x:Name="UBicacion" FontSize="20"
        SelectedItem="{Binding UbicacionBuscada, Mode=TwoWay}"
        ItemsSource="{Binding ColeccionUbicaciones}"
        Margin="2">
                                            </ComboBox>
                                            <Button BorderThickness="0" Command="{Binding IngresarUbicacionCommand}" Margin="10,0,0,0" Grid.Column="1">
                                                <Button.Background>
                                                    <SolidColorBrush Color="Transparent"/>
                                                </Button.Background>
                                                <Image Width="14" Height="14" Source="/iconos/lapizEdicion.png"/>
                                            </Button>
                                        </StackPanel>
                                    </StackPanel>

                                    <Button Style="{StaticResource BotonSinEstilo}" Margin="10,5,10,0" Grid.Row="0" Grid.Column="2" Cursor="Hand"
                                        HorizontalAlignment="Center" VerticalAlignment="Top" Command="{Binding ReiniciarParametrosBusquedaCommand}">
                                        <Button.Background>
                                            <SolidColorBrush Color="Transparent"/>
                                        </Button.Background>
                                        <TextBlock Text="Eliminar parametros" Foreground="Blue" FontSize="16"/>
                                    </Button>
                                </Grid>
                            </Border>
                        </Popup>

                        <Button x:Name="BorrarTexto" Margin="10,5" BorderThickness="0" Command="{Binding EliminarTextoBusquedaCommand}" 
                            HorizontalAlignment="Left" Grid.Column="2" Visibility="{Binding BotonCruzVisible, Converter={StaticResource BooleanToVisibility}}">
                            <Button.Background>
                                <SolidColorBrush Color="Transparent"/>
                            </Button.Background>
                            <Image Width="14" Height="14" Source="/iconos/Cruz2.png"/>
                        </Button>

                    </Grid>
                </Border>

                <Button Style="{StaticResource BotonSinEstilo}" Margin="10,2,10,0" Cursor="Hand"
                HorizontalAlignment="Center" VerticalAlignment="Center" Command="{Binding AlternarFormatoVistaCommand}">
                    <Path Style="{StaticResource CuadradoIcono}">
                        <Path.RenderTransform>
                            <ScaleTransform ScaleX="1" ScaleY="1"/>
                        </Path.RenderTransform>
                        <Path.RenderTransformOrigin>
                            <Point X="0.5" Y="0.5"/>
                        </Path.RenderTransformOrigin>
                    </Path>
                </Button>

                <Button x:Name="Aniadir" Margin="0,0,10,0" BorderThickness="0" Cursor="Hand" Command="{Binding AniadirProductoCommand}">
                    <Button.Background>
                        <SolidColorBrush Color="Transparent"/>
                    </Button.Background>
                    <Image Width="24" Height="24" Source="/iconos/aniadir-registro.png" Style="{StaticResource ImagenHover}"/>
                </Button>

                <Button x:Name="ElegirTodo" Margin="0,0,10,0" BorderThickness="0" Cursor="Hand" Command="{Binding ElegirTodoLoteCommand}">
                    <Button.Background>
                        <SolidColorBrush Color="Transparent"/>
                    </Button.Background>
                    <Image Width="24" Height="24" Source="/iconos/globo1.png" Style="{StaticResource ImagenHover}"/>
                </Button>
            </StackPanel>
        </Grid>
        
        <!--Vista tabular-->
        <DataGrid x:Name="Tabla"  Grid.Row="2" Grid.Column="1" ItemsSource="{Binding ColeccionProductos}"
              Visibility="{Binding MostrarVistaTabular, Converter={StaticResource BooleanToVisibility}}" FontSize="18"
              FontFamily="Monserrat" AutoGenerateColumns="False" Background="Transparent" GridLinesVisibility="None" 
              BorderBrush="Transparent" IsReadOnly="True" SelectionUnit="FullRow" HeadersVisibility="Column">
            <DataGrid.CellStyle>
                <Style TargetType="DataGridCell">
                    <Setter Property="Cursor" Value="Hand"/>
                    <Setter Property="Padding" Value="5,3,5,3"/>
                    <Setter Property="BorderBrush" Value="Transparent"/>
                    <Setter Property="BorderThickness" Value="0,0,1,0"/>
                </Style>
            </DataGrid.CellStyle>
            <DataGrid.RowStyle>
                <Style TargetType="DataGridRow">
                    <Setter Property="ContextMenu" Value="{StaticResource MenuContextualTabla}"/>
                    <EventSetter Event="MouseDoubleClick" Handler="Row_MouseDoubleClick"/>
                </Style>
            </DataGrid.RowStyle>

            <DataGrid.Columns>
                <DataGridTextColumn Header="Producto" Binding="{Binding Nombre}" Visibility="Visible" Width="*"/>
                <DataGridTextColumn Header="Categoría" Binding="{Binding Categoria}" Visibility="Visible"/>
                <DataGridTextColumn Header="Precio" Binding="{Binding Precio}" Visibility="Visible" />
                <DataGridTemplateColumn Header="Fecha" Visibility="Visible">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <TextBlock>
                                <TextBlock.Text>
                                    <MultiBinding Converter="{StaticResource PreferirFechaConverter}">
                                        <Binding Path="FechaModificacion"/>
                                        <Binding Path="FechaCreacion"/>
                                    </MultiBinding>
                                </TextBlock.Text>
                            </TextBlock>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
            </DataGrid.Columns>
        </DataGrid>

        <!--Vista Galeria con Imagenes-->
        <ScrollViewer Grid.Row="2" Grid.Column="1" Visibility="{Binding MostrarVistaGaleria, Converter={StaticResource BooleanToVisibility}}">
            <ItemsControl x:Name="CatalogoItems" ItemsSource="{Binding ColeccionProductos}" 
                VirtualizingStackPanel.IsVirtualizing="True" 
                VirtualizingStackPanel.VirtualizationMode="Recycling">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <WrapPanel Orientation="Horizontal"/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>

                <ItemsControl.ItemContainerStyle>
                    <Style TargetType="ContentPresenter" 
                        BasedOn="{StaticResource NotificationItemEnterAnimation}">
                        <Setter Property="Margin" Value="4"/>
                        <Setter Property="Cursor" Value="Hand"/>

                    </Style>
                </ItemsControl.ItemContainerStyle>

                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border BorderBrush="Black" BorderThickness="0.25" Margin="5" Padding="10" Cursor="Hand" 
                                ContextMenu="{StaticResource MenuContextualGaleria}" Background="Transparent">
                            <Border.InputBindings>
                                <MouseBinding MouseAction="LeftDoubleClick"
                                  Command="{Binding DataContext.ItemDoubleClickCommand,
                                            RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                  CommandParameter="{Binding}"/>
                            </Border.InputBindings>
                            <Border.Style>
                                <Style TargetType="Border">
                                    <Setter Property="Background" Value="White"/>
                                    <Style.Triggers>
                                        <EventTrigger RoutedEvent="MouseEnter">
                                            <BeginStoryboard>
                                                <Storyboard>
                                                    <ColorAnimation To="#f0f0f0" Duration="0:0:0.2"
                                                        Storyboard.TargetProperty="(Border.Background).(SolidColorBrush.Color)"/>
                                                </Storyboard>
                                            </BeginStoryboard>
                                        </EventTrigger>
                                        <EventTrigger RoutedEvent="MouseLeave">
                                            <BeginStoryboard>
                                                <Storyboard>
                                                    <ColorAnimation To="White" Duration="0:0:0.2"
                                                        Storyboard.TargetProperty="(Border.Background).(SolidColorBrush.Color)"/>
                                                </Storyboard>
                                            </BeginStoryboard>
                                        </EventTrigger>
                                        <EventTrigger RoutedEvent="MouseLeftButtonDown">
                                            <BeginStoryboard>
                                                <Storyboard>
                                                    <ColorAnimation To="LightCyan" Duration="0:0:0.1" Storyboard.TargetProperty="(Border.Background).(SolidColorBrush.Color)"/>
                                                </Storyboard>
                                            </BeginStoryboard>
                                        </EventTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Border.Style>
                            <StackPanel Orientation="Vertical">
                                <Border Width="150" Height="150" x:Name="Miniatura">
                                    <Image Source="{Binding Path=RutaImagen}"/>
                                </Border>
                                <Popup IsOpen="{Binding EANModificado}"
                                   PlacementTarget="{Binding ElementName=Miniatura}"
                                   Placement="Bottom"        
                                   StaysOpen="True"
                                   AllowsTransparency="True"
                                   PopupAnimation="Fade"
                                   Panel.ZIndex="1000"
                                   VerticalOffset="1">
                                    <TextBlock FontSize="14">El codigo de barra de este item ha cambiado</TextBlock>
                                </Popup>
                                <TextBlock FontSize="18" FontWeight="Bold" Text="{Binding Nombre}" TextWrapping="Wrap" MaxWidth="200"/>
                                <TextBlock Text="{Binding Path=Categoria, StringFormat='Categoria: {0}'}"/>
                                <TextBlock Text="{Binding Path=Precio, StringFormat='Precio: ${0}'}"/>
                            </StackPanel>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
                
            </ItemsControl>
        </ScrollViewer>
    </Grid>
</UserControl>